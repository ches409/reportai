# 📚 학원 보고서 자동 생성 시스템 사용 가이드

이 문서는 학원 보고서 자동 생성 시스템을 처음 사용하는 분들을 위한 가이드입니다.

---

## 📋 목차

1. [시스템 시작하기](#1-시스템-시작하기)
2. [엑셀 파일 자동 처리](#2-엑셀-파일-자동-처리)
3. [보고서 요청하기](#3-보고서-요청하기)
4. [Notion 데이터베이스 관리](#4-notion-데이터베이스-관리)
5. [문제 해결](#5-문제-해결)

---

## 1. 시스템 시작하기

### 1-1. 가상환경 실행

**단계별 가이드:**

**1단계: 명령 프롬프트(cmd) 창 열기**
- Windows 키를 누르고 "cmd"를 입력합니다
- "명령 프롬프트" 또는 "Command Prompt"를 클릭합니다
- 또는 `Windows 키 + R`을 누르고 "cmd"를 입력한 후 Enter를 누릅니다

**2단계: 프로젝트 폴더로 이동**
- 명령 프롬프트 창에서 다음 명령어를 입력합니다:
  ```
  cd C:\reportai
  ```
- Enter 키를 누릅니다
- 정상적으로 이동했다면 `C:\reportai>` 라고 표시됩니다

**3단계: 가상환경 활성화**
- 다음 명령어를 입력합니다:
  ```
  venv\Scripts\activate
  ```
- Enter 키를 누릅니다

**정상적으로 실행되었다면:**
- 명령 프롬프트 창에 `(venv)` 표시가 나타납니다
- 예: `(venv) C:\reportai>`

**만약 실행되지 않는다면:**

**방법 1: PowerShell 사용**
- 명령 프롬프트 대신 PowerShell을 사용합니다
- Windows 키를 누르고 "PowerShell"을 입력합니다
- PowerShell을 실행한 후:
  ```
  cd C:\reportai
  ```
  ```
  & C:/reportai/venv/Scripts/Activate.ps1
  ```

**방법 2: VS Code에서 실행**
1. VS Code를 엽니다
2. `Ctrl + Shift + P` 키를 누릅니다
3. "Python: Select Interpreter"를 입력하고 선택합니다
4. "Python 3.11.9 (venv)"를 선택합니다
5. VS Code 하단의 터미널에서 자동으로 가상환경이 활성화됩니다

---

### 1-2. 필요한 라이브러리 설치

**한 번만 실행하면 됩니다:**

```
pip install -r requirements.txt
```

**설치가 완료되면:**
- "Successfully installed..." 메시지가 나타납니다
- 오류가 없다면 다음 단계로 진행합니다

---

### 1-3. 설정 확인

**`.env` 파일을 열어서 다음 항목을 확인합니다:**

```
OLLAMA_MODEL="qwen3:8b"
```

이 값이 올바르게 설정되어 있는지 확인하세요.

---

### 1-4. 서버 실행

**가장 쉬운 방법: 배치 파일 사용 (권장)**
- 프로젝트 폴더에서 `start_server.bat` 파일을 **더블클릭**합니다
- 자동으로 가상환경을 활성화하고 서버를 실행합니다
- 콘솔 창이 열리며 서버 상태를 확인할 수 있습니다

**서버가 정상적으로 실행되면:**
- 콘솔 창에 "🚀 학원 보고서 시스템 시작" 메시지가 나타납니다
- "📂 엑셀 파일 자동 처리 워커 시작" 메시지가 나타납니다
- 서버가 계속 실행 중인 상태로 유지됩니다
- 브라우저에서 `http://localhost:8000`으로 접속할 수 있습니다

**서버를 중지하려면:**
- 콘솔 창에서 `Ctrl + C`를 누릅니다
- 또는 콘솔 창을 닫습니다

**다른 실행 방법:**

**방법 2: Python 스크립트 사용**
- 명령 프롬프트에서 다음 명령어를 입력합니다:
  ```
  python start_server.py
  ```

**방법 3: VS Code에서 실행**
- VS Code 편집기 오른쪽 위의 **▶️ Run Python File** 버튼을 클릭합니다

**방법 4: 수동 실행 (고급 사용자)**
- 가상환경이 활성화된 상태에서:
  ```
  python app.py
  ```

---

## 2. 엑셀 파일 자동 처리

### 2-1. 엑셀 파일 준비

**다음 폴더에 엑셀 파일을 넣으세요:**

- `input/class/` - 입소 학생 데이터
- `input/discharge/` - 퇴소 학생 데이터  
- `input/student/` - 학생 기본 정보

**파일 형식:**
- `.xlsx` 또는 `.xls` 형식의 엑셀 파일

---

### 2-2. 자동 처리 과정

**시스템이 자동으로 다음 작업을 수행합니다:**

1. **파일 감지** (10초마다)
   - 새로 추가된 엑셀 파일을 자동으로 감지합니다

2. **전처리**
   - 여러 파일을 하나로 합칩니다
   - 중복된 데이터를 제거합니다
   - 반명에 "TEST", "면접", "자소서", "상담", "대입"이 포함된 데이터를 제거합니다
   - Notion에 이미 있는 날짜 범위의 데이터를 제외합니다

3. **Notion 데이터베이스에 추가**
   - 전처리된 데이터를 Notion에 자동으로 추가합니다

4. **파일 이동**
   - 처리된 파일들은 `input/imported/` 폴더로 이동합니다
   - 파일명에 날짜와 시간이 추가되어 중복을 방지합니다

**처리 시간:**
- 파일당 약 1-2분 소요됩니다
- 데이터가 많을수록 시간이 더 걸립니다

---

### 2-3. 처리 결과 확인

**성공적으로 처리되면:**
- 터미널에 "✅ Notion DB에 X개 추가 완료" 메시지가 나타납니다
- 파일이 `input/imported/` 폴더로 이동합니다

**데이터가 없어도:**
- 파일은 자동으로 `input/imported/` 폴더로 이동합니다
- "⚠️ 전처리 후 데이터가 없지만 파일은 이동합니다" 메시지가 나타납니다

---

## 3. 보고서 요청하기

### 3-1. 보고서 요청 방법

**Notion에서 보고서를 요청합니다:**

1. 다음 링크로 이동합니다:
   ```
   https://www.notion.so/2d32f86d712c802ca711cac666000c60
   ```

2. **"질문"** 열에 보고서 요청 내용을 입력합니다
   - 예: "김상윤 선생님 2025년 1월 입퇴소 현황 알려줘"
   - 예: "2025년 3월부터 7월까지 퇴소 사유 통계"

3. **"상태"** 열이 자동으로 **"대기중"**으로 설정됩니다

---

### 3-2. 보고서 생성 과정

**시스템이 자동으로 처리합니다:**

1. **30초마다** "대기중" 상태의 요청을 확인합니다
2. AI가 질문을 분석하여 필요한 데이터를 조회합니다
3. Excel 보고서를 생성합니다
4. 상태가 **"완료됨"**으로 변경됩니다

**처리 시간:**
- 약 20~30초 소요됩니다
- 복잡한 요청일수록 시간이 더 걸릴 수 있습니다

---

### 3-3. 보고서 확인

**생성된 보고서는 다음 위치에 저장됩니다:**
- `temp/` 폴더
- 파일명 형식: `discharge_chart_[선생님명]_[날짜시간].xlsx`

**보고서 내용:**
- 월별 입퇴소 현황
- 월별 퇴소 사유 통계
- 반별 입퇴소 현황
- 반별 퇴소 사유 통계
- 학생별 상세 명단
- 차트 및 그래프

---

### 3-4. 보고서 재요청

**AI가 보고서를 잘못 작성한 경우:**

1. Notion에서 해당 요청의 **"상태"**를 **"대기중"**으로 다시 변경합니다
2. 필요하면 **"질문"** 내용을 수정합니다
3. 시스템이 자동으로 다시 처리합니다

---

## 4. Notion 데이터베이스 관리

### 4-1. 데이터베이스 접근

**다음 링크로 접근합니다:**
```
https://www.notion.so/database-2d32f86d712c808fb36aeba2c43af21d
```

**데이터베이스 종류:**
- **class** - 입소 학생 데이터
- **discharge** - 퇴소 학생 데이터
- **student** - 학생 기본 정보

---

### 4-2. 데이터 입력/수정/삭제

**읽기/쓰기 권한이 있는 경우:**
- 직접 데이터를 입력, 수정, 삭제할 수 있습니다
- 엑셀 파일을 통한 자동 입력도 가능합니다

**읽기 전용 권한인 경우:**
- 데이터를 볼 수만 있습니다
- 입력, 수정, 삭제는 불가능합니다

---

## 5. 문제 해결

### 5-1. WeasyPrint 라이브러리 오류

**오류 메시지:**
- "gobject-2.0-0이 없다" 또는 비슷한 메시지

**해결 방법:**

1. **MSYS2 설치 및 실행**
   - `C:\msys64` 폴더가 있는지 확인합니다
   - 없다면 MSYS2를 설치합니다
   - `C:\msys64\msys2.exe`를 실행합니다

2. **필요한 패키지 설치**
   MSYS2 터미널에서 다음 명령어를 순서대로 입력합니다:
   ```
   pacman -Syu
   ```
   (중간에 꺼졌다면 `pacman -Su` 입력)
   
   그 다음:
   ```
   pacman -S mingw-w64-x86_64-pango
   pacman -S mingw-w64-x86_64-cairo
   pacman -S mingw-w64-x86_64-gdk-pixbuf2
   pacman -S mingw-w64-x86_64-glib2
   ```

3. **환경 변수 설정**
   - Windows 검색에서 "환경 변수"를 검색합니다
   - "시스템 환경 변수 편집"을 선택합니다
   - "환경 변수" 버튼을 클릭합니다
   - "시스템 변수"에서 "Path"를 선택하고 "편집"을 클릭합니다
   - "새로 만들기"를 클릭하고 `C:\msys64\mingw64\bin`을 입력합니다
   - "확인"을 클릭하여 모든 창을 닫습니다

4. **서버 재시작**
   - 컴퓨터를 재시작하거나
   - 서버를 종료하고 다시 실행합니다

---

### 5-2. 서버가 시작되지 않을 때

**확인 사항:**

1. **가상환경이 활성화되었는지 확인**
   - 터미널에 `(venv)` 표시가 있는지 확인합니다

2. **라이브러리가 설치되었는지 확인**
   - `pip install -r requirements.txt`를 다시 실행합니다

3. **Python 버전 확인**
   - Python 3.11.9가 설치되어 있는지 확인합니다

4. **포트가 사용 중인지 확인**
   - 다른 프로그램이 같은 포트를 사용하고 있을 수 있습니다
   - 서버를 종료하고 다시 시작합니다

---

### 5-3. 엑셀 파일이 처리되지 않을 때

**확인 사항:**

1. **파일 위치 확인**
   - 파일이 올바른 폴더(`input/class/`, `input/discharge/`, `input/student/`)에 있는지 확인합니다

2. **파일 형식 확인**
   - `.xlsx` 또는 `.xls` 형식인지 확인합니다

3. **헤더(첫 번째 행) 확인**
   - 엑셀 파일을 열어서 **첫 번째 행이 컬럼명(헤더)인지 확인**합니다
   - 예: "학생명", "반명", "담당", "퇴원일자" 등
   - 첫 번째 행에 데이터가 있으면 안 됩니다 (컬럼명이어야 함)
   - 빈 행이 첫 번째에 있으면 제거합니다

4. **서버 실행 확인**
   - 서버가 정상적으로 실행 중인지 확인합니다
   - 터미널에 "📂 엑셀 파일 자동 처리 워커 시작" 메시지가 있는지 확인합니다

5. **처리 시간 대기**
   - 파일 추가 후 최대 10초 정도 기다립니다
   - 시스템이 10초마다 파일을 확인합니다

---

### 5-4. 보고서가 생성되지 않을 때

**확인 사항:**

1. **상태 확인**
   - Notion에서 요청의 상태가 "대기중"인지 확인합니다

2. **질문 형식 확인**
   - 질문이 명확하게 작성되었는지 확인합니다
   - 예: "김상윤 선생님 2025년 1월 입퇴소 현황 알려줘"

3. **처리 시간 대기**
   - 요청 후 최대 30초 정도 기다립니다
   - 시스템이 30초마다 요청을 확인합니다

4. **오류 확인**
   - 터미널에 오류 메시지가 있는지 확인합니다
   - 오류가 있다면 상태를 "대기중"으로 다시 변경하여 재시도합니다

---

## 📞 추가 도움말

**문제가 해결되지 않으면:**
- 터미널에 나타나는 오류 메시지를 확인하세요
- 오류 메시지를 복사하여 기술 지원팀에 문의하세요

**시스템 정보:**
- Python 버전: 3.11.9
- AI 모델: qwen3:8b (Ollama)
- 처리 주기: 엑셀 파일 10초마다, 보고서 요청 30초마다

---

**마지막 업데이트: 2026년 1월**
